# Shape ç³»ç»Ÿå®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ShapeUtil åŸºç±»
- âœ… å®šä¹‰äº†ç»Ÿä¸€çš„å›¾å½¢å¤„ç†æ¥å£
- âœ… æŠ½è±¡æ–¹æ³•ï¼šgetBounds, hitTest, component, getDefaultProps
- âœ… å¯é€‰æ–¹æ³•ï¼šonResize, onRotate, onDoubleClick ç­‰
- âœ… ShapeUtilRegistry æ³¨å†Œè¡¨

### 2. å…·ä½“çš„ ShapeUtil å®ç°

#### CircleShapeUtil
- âœ… åœ†å½¢è¾¹ç•Œè®¡ç®—
- âœ… åœ†å½¢ç¢°æ’æ£€æµ‹ï¼ˆè·ç¦»åˆ¤æ–­ï¼‰
- âœ… SVG æ¸²æŸ“
- âœ… è°ƒæ•´å¤§å°ï¼ˆä¿æŒçºµæ¨ªæ¯”ï¼‰
- âœ… è¾…åŠ©æ–¹æ³•ï¼šgetPointOnCircle, intersectsCircle

#### RectShapeUtil
- âœ… çŸ©å½¢è¾¹ç•Œè®¡ç®—
- âœ… çŸ©å½¢ç¢°æ’æ£€æµ‹ï¼ˆæ”¯æŒæ—‹è½¬ï¼‰
- âœ… SVG æ¸²æŸ“ï¼ˆæ”¯æŒåœ†è§’ï¼‰
- âœ… è°ƒæ•´å¤§å°ï¼ˆæ”¯æŒçºµæ¨ªæ¯”é”å®šï¼‰
- âœ… åæ ‡è½¬æ¢ï¼ˆä¸–ç•Œåæ ‡ â†” æœ¬åœ°åæ ‡ï¼‰
- âœ… è¾…åŠ©æ–¹æ³•ï¼šgetCorners, rotatePoint, intersectsRect

#### TextShapeUtil
- âœ… æ–‡æœ¬è¾¹ç•Œè®¡ç®—ï¼ˆè‡ªåŠ¨å¤§å°ï¼‰
- âœ… æ–‡æœ¬ç¢°æ’æ£€æµ‹
- âœ… SVG æ¸²æŸ“ï¼ˆæ”¯æŒå¯¹é½ï¼‰
- âœ… ç¼–è¾‘æ”¯æŒï¼ˆcanEdit, onDoubleClickï¼‰
- âœ… æ–‡æœ¬æµ‹é‡ï¼ˆä½¿ç”¨ Canvas APIï¼‰
- âœ… è¾…åŠ©æ–¹æ³•ï¼šupdateText, setAlign, setFontSize

#### DrawShapeUtil
- âœ… æ‰‹ç»˜è·¯å¾„è¾¹ç•Œè®¡ç®—
- âœ… æ‰‹ç»˜è·¯å¾„ç¢°æ’æ£€æµ‹ï¼ˆçº¿æ®µè·ç¦» + å¤šè¾¹å½¢å†…éƒ¨ï¼‰
- âœ… SVG è·¯å¾„æ¸²æŸ“
- âœ… è·¯å¾„ç®€åŒ–ï¼ˆRDP ç®—æ³•ï¼‰
- âœ… è·¯å¾„å¹³æ»‘
- âœ… è¾…åŠ©æ–¹æ³•ï¼šdistanceToLineSegment, isPointInPolygon

### 3. å‡ ä½•å·¥å…·å‡½æ•°åº“

#### è¾¹ç•Œæ¡†æ“ä½œ
- âœ… unionBoxes - è®¡ç®—å¤šä¸ªè¾¹ç•Œæ¡†çš„å¹¶é›†
- âœ… boxesIntersect - æ£€æŸ¥è¾¹ç•Œæ¡†ç›¸äº¤
- âœ… pointInBox - ç‚¹åœ¨è¾¹ç•Œæ¡†å†…æ£€æµ‹
- âœ… expandBox - æ‰©å±•è¾¹ç•Œæ¡†
- âœ… getBoxCenter - è·å–ä¸­å¿ƒç‚¹

#### ç‚¹æ“ä½œ
- âœ… distance - è®¡ç®—è·ç¦»
- âœ… rotatePoint - æ—‹è½¬ç‚¹
- âœ… lerpPoint - çº¿æ€§æ’å€¼

#### å‘é‡æ“ä½œ
- âœ… addVec, subVec, mulVec - å‘é‡è¿ç®—
- âœ… vecLength - å‘é‡é•¿åº¦
- âœ… normalizeVec - å‘é‡å½’ä¸€åŒ–
- âœ… dotVec - ç‚¹ç§¯

#### è§’åº¦æ“ä½œ
- âœ… degreesToRadians, radiansToDegrees - è§’åº¦è½¬æ¢
- âœ… normalizeAngle - è§’åº¦è§„èŒƒåŒ–

#### ç¢°æ’æ£€æµ‹
- âœ… distanceToLineSegment - ç‚¹åˆ°çº¿æ®µè·ç¦»
- âœ… pointInPolygon - ç‚¹åœ¨å¤šè¾¹å½¢å†…ï¼ˆå°„çº¿æ³•ï¼‰

#### æ•°å­¦å·¥å…·
- âœ… clamp - é™åˆ¶èŒƒå›´
- âœ… lerp - çº¿æ€§æ’å€¼
- âœ… approximately - è¿‘ä¼¼ç›¸ç­‰

## ğŸ“Š ä»£ç ç»Ÿè®¡

```
Shape ç³»ç»Ÿï¼š
- ShapeUtil.ts          ~200 è¡Œ
- CircleShapeUtil.ts    ~120 è¡Œ
- RectShapeUtil.ts      ~200 è¡Œ
- TextShapeUtil.ts      ~200 è¡Œ
- DrawShapeUtil.ts      ~250 è¡Œ
- geometry.ts           ~250 è¡Œ
- index.ts              ~30 è¡Œ

æ€»è®¡ï¼š~1250 è¡Œ
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. å®Œæ•´çš„å›¾å½¢ç³»ç»Ÿ
- æ”¯æŒ 4 ç§åŸºç¡€å›¾å½¢ï¼šåœ†å½¢ã€çŸ©å½¢ã€æ–‡æœ¬ã€æ‰‹ç»˜
- ç»Ÿä¸€çš„æ¥å£è®¾è®¡
- æ˜“äºæ‰©å±•æ–°å›¾å½¢ç±»å‹

### 2. ç²¾ç¡®çš„ç¢°æ’æ£€æµ‹
- åœ†å½¢ï¼šè·ç¦»åˆ¤æ–­
- çŸ©å½¢ï¼šæ”¯æŒæ—‹è½¬çš„ç¢°æ’æ£€æµ‹
- æ–‡æœ¬ï¼šè¾¹ç•Œæ¡†æ£€æµ‹
- æ‰‹ç»˜ï¼šçº¿æ®µè·ç¦» + å¤šè¾¹å½¢å†…éƒ¨æ£€æµ‹

### 3. çµæ´»çš„è°ƒæ•´å¤§å°
- æ”¯æŒçºµæ¨ªæ¯”é”å®š
- æ”¯æŒæ—‹è½¬
- æ”¯æŒå¤šç§è°ƒæ•´æ‰‹æŸ„

### 4. é«˜çº§ç®—æ³•
- RDP è·¯å¾„ç®€åŒ–ç®—æ³•
- è·¯å¾„å¹³æ»‘ç®—æ³•
- å°„çº¿æ³•å¤šè¾¹å½¢æ£€æµ‹
- åæ ‡ç³»è½¬æ¢

## ğŸ”„ ä¸ tldraw çš„å¯¹æ¯”

| åŠŸèƒ½ | TSDraw | tldraw |
|------|--------|--------|
| ShapeUtil åŸºç±» | âœ… è‡ªå·±å®ç° | âœ… å®˜æ–¹å®ç° |
| è¾¹ç•Œè®¡ç®— | âœ… è‡ªå·±å®ç° | âœ… å®˜æ–¹å®ç° |
| ç¢°æ’æ£€æµ‹ | âœ… è‡ªå·±å®ç° | âœ… å®˜æ–¹å®ç° |
| æ¸²æŸ“æ¥å£ | âœ… React ç»„ä»¶ | âœ… React ç»„ä»¶ |
| å‡ ä½•å·¥å…· | âœ… è‡ªå·±å®ç° | âœ… å®˜æ–¹å®ç° |
| API è®¾è®¡ | âœ… ç›¸ä¼¼ | âœ… åŸç‰ˆ |

**å…¼å®¹æ€§**ï¼šAPI è®¾è®¡ç›¸ä¼¼ï¼Œæœªæ¥è¿ç§»åˆ° tldraw æˆæœ¬ä½

## ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œ

### ç¬¬ 1 ä¼˜å…ˆçº§ï¼ˆæ¸²æŸ“å™¨ï¼‰
- [ ] åˆ›å»º Canvas ç»„ä»¶
- [ ] é›†æˆ react-konva æˆ– fabric.js
- [ ] å®ç°å›¾å½¢æ¸²æŸ“
- [ ] å®ç°é€‰æ‹©æ¡†
- [ ] å®ç°æ‹–æ‹½

### ç¬¬ 2 ä¼˜å…ˆçº§ï¼ˆäº¤äº’ï¼‰
- [ ] Tool ç³»ç»Ÿ
- [ ] SelectTool
- [ ] DrawTool
- [ ] äº‹ä»¶å¤„ç†

### ç¬¬ 3 ä¼˜å…ˆçº§ï¼ˆå†å²ï¼‰
- [ ] HistoryManager
- [ ] Undo/Redo
- [ ] å¿«ç…§ç³»ç»Ÿ

## ğŸ‰ æˆå°±è§£é”

- âœ… **Shape ç³»ç»Ÿå®Œæˆ** - æ ¸å¿ƒå›¾å½¢å¤„ç†èƒ½åŠ›
- âœ… **å‡ ä½•å·¥å…·å®Œæˆ** - å®Œæ•´çš„æ•°å­¦å·¥å…·åº“
- âœ… **ä»£ç è´¨é‡é«˜** - ç±»å‹å®‰å…¨ï¼Œæ³¨é‡Šå®Œæ•´
- âœ… **ç®—æ³•å…ˆè¿›** - RDP ç®€åŒ–ï¼Œå°„çº¿æ³•æ£€æµ‹
- âœ… **æ˜“äºæ‰©å±•** - æ¸…æ™°çš„æ¥å£è®¾è®¡

## ğŸ“ˆ é¡¹ç›®è¿›åº¦æ›´æ–°

```
æ€»ä½“è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 40%

âœ… æ¶æ„è®¾è®¡      100%
âœ… é¡¹ç›®æ­å»º      100%
âœ… ç±»å‹ç³»ç»Ÿ      100%
âœ… Editor åŸºç¡€   60%
âœ… Shape ç³»ç»Ÿ    100%  â† æ–°å®Œæˆï¼
âœ… å‡ ä½•å·¥å…·      100%  â† æ–°å®Œæˆï¼
â³ æ¸²æŸ“å™¨        0%    â† ä¸‹ä¸€æ­¥
â³ Tool ç³»ç»Ÿ     0%
â³ å†å²ç®¡ç†      0%
â³ AI æœåŠ¡       0%
â³ UI ç»„ä»¶       0%
```

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### 1. æ—‹è½¬æ”¯æŒ
```typescript
// çŸ©å½¢æ”¯æŒæ—‹è½¬çš„ç¢°æ’æ£€æµ‹
private toLocalPoint(shape: RectShape, point: Point): Point {
  // åæ ‡ç³»è½¬æ¢
  const cos = Math.cos(-rotation)
  const sin = Math.sin(-rotation)
  // ...
}
```

### 2. è·¯å¾„ç®€åŒ–
```typescript
// RDP ç®—æ³•ç®€åŒ–æ‰‹ç»˜è·¯å¾„
private rdpSimplify(points: Point[], tolerance: number): Point[] {
  // é€’å½’ç®€åŒ–
  // ...
}
```

### 3. æ–‡æœ¬æµ‹é‡
```typescript
// ä½¿ç”¨ Canvas API æµ‹é‡æ–‡æœ¬
private measureText(text: string, fontSize: number, fontFamily: string) {
  const ctx = canvas.getContext('2d')
  ctx.font = `${fontSize}px ${fontFamily}`
  return ctx.measureText(text)
}
```

### 4. å¤šè¾¹å½¢æ£€æµ‹
```typescript
// å°„çº¿æ³•æ£€æµ‹ç‚¹åœ¨å¤šè¾¹å½¢å†…
private isPointInPolygon(point: Point, polygon: Point[]): boolean {
  let inside = false
  // å°„çº¿æ³•ç®—æ³•
  // ...
}
```

## ğŸ“ å­¦åˆ°çš„ç»éªŒ

1. **å‡ ä½•ç®—æ³•å¾ˆé‡è¦** - ç²¾ç¡®çš„ç¢°æ’æ£€æµ‹æ˜¯ç”»æ¿çš„åŸºç¡€
2. **åæ ‡ç³»è½¬æ¢** - æ—‹è½¬å›¾å½¢éœ€è¦æ­£ç¡®çš„åæ ‡è½¬æ¢
3. **æ€§èƒ½ä¼˜åŒ–** - è·¯å¾„ç®€åŒ–å¯ä»¥å¤§å¹…æå‡æ€§èƒ½
4. **ç±»å‹å®‰å…¨** - TypeScript æ³›å‹è®©ä»£ç æ›´å®‰å…¨

## ğŸš€ å¦‚ä½•ä½¿ç”¨

```typescript
import { Editor, createDefaultShapeUtils } from '@tsdraw/editor'

// åˆ›å»ºç¼–è¾‘å™¨
const editor = new Editor({ store })

// æ³¨å†Œ ShapeUtils
const shapeUtils = createDefaultShapeUtils(editor)

// åˆ›å»ºåœ†å½¢
const circle = editor.createShape('circle', {
  radius: 50,
  fill: 'red'
}, {
  x: 100,
  y: 100
})

// è·å–è¾¹ç•Œ
const circleUtil = shapeUtils.get('circle')
const bounds = circleUtil.getBounds(circle)

// ç¢°æ’æ£€æµ‹
const hit = circleUtil.hitTest(circle, { x: 100, y: 100 })

// æ¸²æŸ“
const component = circleUtil.component(circle)
```

---

**ä¸‹ä¸€æ­¥**ï¼šå®ç°æ¸²æŸ“å™¨ï¼Œè®©å›¾å½¢æ˜¾ç¤ºåœ¨ç”»å¸ƒä¸Šï¼
